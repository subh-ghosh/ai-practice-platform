# Server Port
server.port=${PORT:8080}

# Database Configuration (Will be injected by Cloud)
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}

# Hibernate Settings
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true

# API Keys (Environment Variables)
groq.api.key=${GROQ_API_KEY}
ai.model.practice=${AI_MODEL_PRACTICE:llama-3.1-8b-instant}
ai.model.study-plan=${AI_MODEL_STUDY_PLAN:llama-3.3-70b-versatile}
youtube.api.key=${YOUTUBE_API_KEY}
google.client-id=${GOOGLE_CLIENT_ID}
razorpay.key.id=${RAZORPAY_KEY_ID}
razorpay.key.secret=${RAZORPAY_KEY_SECRET}

# Frontend Connection (Allow your future cloud frontend)
app.frontend.url=${FRONTEND_URL}

# JWT Configuration
jwt.secret=${JWT_SECRET}
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always
management.endpoint.prometheus.enabled=true
management.prometheus.metrics.export.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.slo[http.server.requests]=50ms,100ms,200ms,500ms,1s,2s,5s,10s,30s
management.metrics.distribution.percentiles.http.server.requests=0.5,0.95,0.99
management.otlp.metrics.export.enabled=${OTLP_METRICS_ENABLED:false}
management.otlp.metrics.export.url=${OTEL_EXPORTER_OTLP_ENDPOINT:}
management.otlp.metrics.export.headers.Authorization=${OTEL_EXPORTER_OTLP_AUTH:}
management.health.circuitbreakers.enabled=true
management.endpoint.health.probes.enabled=true

# AI request timeout
ai.request.timeout-seconds=${AI_REQUEST_TIMEOUT_SECONDS:8}

# Resilience4j defaults for AI provider calls
resilience4j.retry.instances.aiProvider.max-attempts=${RESILIENCE_AI_RETRY_MAX_ATTEMPTS:1}
resilience4j.retry.instances.aiProvider.wait-duration=${RESILIENCE_AI_RETRY_WAIT_DURATION:100ms}
resilience4j.retry.instances.aiProvider.enable-exponential-backoff=${RESILIENCE_AI_RETRY_EXP_BACKOFF:true}
resilience4j.retry.instances.aiProvider.exponential-backoff-multiplier=${RESILIENCE_AI_RETRY_BACKOFF_MULTIPLIER:2.0}

resilience4j.circuitbreaker.instances.aiProvider.sliding-window-type=${RESILIENCE_AI_CB_WINDOW_TYPE:COUNT_BASED}
resilience4j.circuitbreaker.instances.aiProvider.sliding-window-size=${RESILIENCE_AI_CB_WINDOW_SIZE:20}
resilience4j.circuitbreaker.instances.aiProvider.minimum-number-of-calls=${RESILIENCE_AI_CB_MIN_CALLS:6}
resilience4j.circuitbreaker.instances.aiProvider.failure-rate-threshold=${RESILIENCE_AI_CB_FAILURE_RATE:40}
resilience4j.circuitbreaker.instances.aiProvider.slow-call-rate-threshold=${RESILIENCE_AI_CB_SLOW_RATE:50}
resilience4j.circuitbreaker.instances.aiProvider.slow-call-duration-threshold=${RESILIENCE_AI_CB_SLOW_DURATION:3s}
resilience4j.circuitbreaker.instances.aiProvider.wait-duration-in-open-state=${RESILIENCE_AI_CB_OPEN_WAIT:20s}
resilience4j.circuitbreaker.instances.aiProvider.permitted-number-of-calls-in-half-open-state=${RESILIENCE_AI_CB_HALF_OPEN_CALLS:5}
resilience4j.circuitbreaker.instances.aiProvider.automatic-transition-from-open-to-half-open-enabled=true

resilience4j.bulkhead.instances.aiProvider.max-concurrent-calls=${RESILIENCE_AI_BULKHEAD_MAX_CALLS:8}
resilience4j.bulkhead.instances.aiProvider.max-wait-duration=${RESILIENCE_AI_BULKHEAD_MAX_WAIT:0}

# Bucket4j in-memory limits (entry-point protection for expensive endpoints)
rate.limit.ai.user.capacity=${RATE_LIMIT_AI_USER_CAPACITY:60}
rate.limit.ai.user.refill-minutes=${RATE_LIMIT_AI_USER_REFILL_MINUTES:1}
rate.limit.ai.ip.capacity=${RATE_LIMIT_AI_IP_CAPACITY:20}
rate.limit.ai.ip.refill-minutes=${RATE_LIMIT_AI_IP_REFILL_MINUTES:1}
rate.limit.study-plan.user.capacity=${RATE_LIMIT_STUDY_PLAN_USER_CAPACITY:10}
rate.limit.study-plan.user.refill-minutes=${RATE_LIMIT_STUDY_PLAN_USER_REFILL_MINUTES:60}
rate.limit.study-plan.ip.capacity=${RATE_LIMIT_STUDY_PLAN_IP_CAPACITY:3}
rate.limit.study-plan.ip.refill-minutes=${RATE_LIMIT_STUDY_PLAN_IP_REFILL_MINUTES:60}
jwt.refreshExpirationMs=86400000

# Cache / Redis
spring.cache.type=redis
spring.data.redis.url=${REDIS_URL:}
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.ssl.enabled=${REDIS_SSL:false}
logging.level.org.springframework.cache=INFO
logging.level.org.springframework.data.redis=INFO
